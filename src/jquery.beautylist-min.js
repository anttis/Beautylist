typeof jQuery!="undefined"&&jQuery(function(e){function n(n,i){var s,o,u,a,f,l,c,h,p,d={ENTER:13,BACKSPACE:8,TAB:9,SPACE:32,ARROW_LEFT:37,ARROW_RIGHT:39,ARROW_UP:38,ARROW_DOWN:40,ESC:27,DELETE:46},v={separator:/(?:,|\s|;)/g,placeholderText:undefined,inPlaceEdit:!1,dynamicInputSizing:!0,saveOnSpace:!0,allowDuplicates:!1,validators:[]},m=e.extend({},v,i);return i.placeholderText&&(m.dynamicInputSizing=!1),l=this,this.init=function(n,r){s=n,a=r,c=a.separator,a.validators.push(function(e){return!e.match(c)}),f=[],this.createElements(),this.bindEvents();if(a.placeholderText&&a.dynamicInputSizing)throw new Error('Can not use options "placeholderText" and "dynamicInputSizing" at the same time.');a.placeholderText&&!t&&l.polyfillPlaceholder(),a.dynamicInputSizing&&(this.initInputResizing(),this.resizeInput()),a.autocomplete&&this.initAutocomplete(o,a.autocomplete);if(a.inPlaceEdit){if(a.autocomplete)throw new Error('Can not use options "inPlaceEdit" and "autocomplete" at the same time.');this.initInPlaceEdit()}return e.trim(s.val())!==""&&this.preFillItems(),this},this.createElements=function(){h=e('<div class="beautylist"><ul><li class="beautylist-input-container"><input class="beautylist-input" type="text" /></li></ul></div>'),o=h.find("input"),u=h.find("ul"),s.hide().after(h),a.placeholderText&&o.attr("placeholder",a.placeholderText),this.createRuler()},this.bindEvents=function(){s.bind("beautylist-reset",l.reset),o.bind("keyup paste",l.parseItem).bind("keydown",l.handleKeyEvent),o.bind("blur",function(){a.autocomplete?h.find("#ui-active-menuitem").length||l.addItem():l.addItem()}),h.bind("click",function(t){var n=e(t.target);(n.is("ul")||n.is("div"))&&o.focus()}),l.bindListEvents()},this.handleKeyEvent=function(e){switch(e.which){case d.SPACE:if(!m.saveOnSpace)break;case d.ENTER:case d.TAB:e.preventDefault(),a.autocomplete?h.find("#ui-active-menuitem").length||(l.addItem(),o.autocomplete("close")):l.addItem();break;case d.BACKSPACE:case d.ARROW_LEFT:o.val()||(e.preventDefault(),e.stopPropagation(),l.focusToLastElement());break;default:}},this.bindListEvents=function(){var t;u.on("click","a",function(t){t.preventDefault(),e(this.focus())}).on("click",".beautylist-delete-item",function(t){l.removeItem(e(this).closest("li"))}).on("keydown",".beautylist-item a:focus",function(n){var r=e(this);switch(n.which){case d.BACKSPACE:case d.DELETE:var i=l.getNextItem(r);n.preventDefault(),n.stopPropagation(),l.removeItem(r.closest(".beautylist-item"),function(){i.focus()});break;case d.ARROW_LEFT:case d.ARROW_UP:case d.ARROW_RIGHT:case d.ARROW_DOWN:t=n.which===d.ARROW_UP||n.which===d.ARROW_LEFT?l.getPreviousItem(r):l.getNextItem(r),t.focus(),n.preventDefault()}})},this.focusToLastElement=function(){u.find(".beautylist-item:last a").length&&u.find(".beautylist-item:last a").focus()},this.getPreviousItem=function(e){return u.find(".beautylist-item").length<2?o:e.parent().prev(".beautylist-item").find("a")},this.getNextItem=function(e){return e.parent().next(".beautylist-item").length?e.parent().next(".beautylist-item").find("a"):o},this.parseItem=function(){var e=o.val();e.match(c)&&l.addItemsToList(e)},this.addItem=function(){var e=o.val();e!==""&&l.addItemsToList(e)},this.preFillItems=function(){var e=s.val();e.match(c)&&l.addItemsToList(e)},this.addItemsToList=function(t){o.val("");var n=e.grep(t.split(c),function(e){return e!==""});e.each(n,function(t,n){var r=e('<li class="beautylist-item"><a href="#"><span>'+n+'</span><button class="beautylist-delete-item"></button></a></li>').data("beautylist-value",n);u.find("li:last").before(r)}),this.updateOriginalInput(),this.toggleValidClasses()},this.toggleValidClasses=function(){u.find(".beautylist-item").each(function(t,n){var i=e(n);i.toggleClass("invalid",!l.validate(r(i)))})},this.validate=function(t){var n=!0;return a.allowDuplicates||(n=e.grep(f,function(e){return e===t}).length<=1),a.validators&&e.each(a.validators,function(e,r){n=n&&r.apply(l,[t])}),!!n},this.updateOriginalInput=function(){f=[],u.find(".beautylist-item").each(function(t,n){f.push(r(e(n)))}),s.val(e.trim(f.join(", "))).trigger("change")},this.removeItem=function(t,n){t.fadeOut(125,function(){e(this).remove(),l.updateOriginalInput(),l.toggleValidClasses(),n&&n()})},this.initInPlaceEdit=function(){u.off("click","a"),u.on("click","a",function(t){t.preventDefault(),l.toggleEditmode(e(this).closest(".beautylist-item"))})},this.initAutocomplete=function(t,n){t.on("focus",function(){var r=null,i=function(e,t){r&&r.item&&l.addItem(),r=null,n.close&&n.close(e,t)},s=function(e,r){t.val(r.value),n.change&&n.change(e,r)},o=function(e,i){r=i,t.val(i.item.value),n.select&&n.select(e,i)},u=e.extend({},n,{appendTo:h,change:s,close:i,select:o});t.autocomplete(u)})},this.toggleEditmode=function(t){var n=r(t),i=e('<input type="text" class="beautylist-in-place-edit"/>');t.find("span").css("visibility","hidden"),e(document).on("keyup.beautylist",function(e){e.which===d.ESC&&l.abortInPlaceEditOnEsc(t,n)}),i.val(r(t)).css("max-width",t.closest(".beautylist").width()).bind("blur",function(){var n=i.val();n===""?(e(document).off("keyup.beautylist"),l.removeItem(e(this).closest("li"))):(r(t,n),t.find("span").text(n).css("visibility","visible"),i.remove(),l.updateOriginalInput(),l.toggleValidClasses())}).bind("keyup keydown",function(e){t.find("span").text(i.val())}).prependTo(t).focus()},this.abortInPlaceEditOnEsc=function(t,n){r(t,n),t.find("span").text(n).css("visibility","visible"),t.find("input").remove(),e(document).off("keyup.beautylist")},this.reset=function(){s.val("").trigger("change"),u.find(".beautylist-item").remove(),f=[]},this.initInputResizing=function(){o.css("width","100%").parent().css("width","100%").bind("keyup keydown",l.stretchInputToGivenText),o.bind("blur",function(){p.text(m.placeholderText?m.placeholderText:""),l.resizeInput()})},this.stretchInputToGivenText=function(){p.text(o.val()),l.resizeInput()},this.resizeInput=function(e){var t=p.outerWidth();o.css("width",t),o.parent().css("width",t)},this.createRuler=function(){p=e('<span class="beautylist-ruler"></span>'),p.css({position:"absolute",left:"-9999px",top:0}),p.appendTo("body")},this.polyfillPlaceholder=function(){this.showPlaceholder(),o.bind("blur",function(e){l.showPlaceholder()}).bind("focus",function(e){l.hidePlaceholder()})},this.showPlaceholder=function(){o.val(a.placeholderText).addClass("beautylist-placeholder")},this.hidePlaceholder=function(){o.val("").removeClass("beautylist-placeholder")},this.init(n,m)}function r(e,t){return t?e.data("beautylist-value",t):e.data("beautylist-value")}e.fn.extend({beautyList:function(t){return this.each(function(){var r=e(this),i=new n(r,t);r.data("beautyList",i)})}});var t="placeholder"in document.createElement("input")}(jQuery));